<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>Dashboard - SB Admin</title>

  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.0/css">
  <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
  <link href="/css/styles.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"
    crossorigin="anonymous"></script>
</head>

<body class="sb-nav-fixed">
  <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
    <!-- Navbar Brand-->
    <a class="navbar-brand ps-3" href="index.html">Cart</a>
    <!-- Sidebar Toggle-->
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i
        class="fas fa-bars"></i></button>
    <!-- Navbar Search-->
    <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
      <div class="input-group">
        <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..."
          aria-describedby="btnNavbarSearch" />
        <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
      </div>
    </form>
    <!-- Navbar-->
    <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown"
          aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
          <li><a class="dropdown-item" href="#!">Settings</a></li>
          <li><a class="dropdown-item" href="#!">Activity Log</a></li>
          <li>
            <hr class="dropdown-divider" />
          </li>
          <li><a class="dropdown-item" href="#!">Logout</a></li>
        </ul>
      </li>
    </ul>
  </nav>
  <div id="layoutSidenav">
    <div id="layoutSidenav_nav">
      <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
        <div class="sb-sidenav-menu">
          <div class="nav">
            <div class="sb-sidenav-menu-heading">Core</div>
            <a class="nav-link" href="/admin/dashboard">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              Dashboard
            </a>
            <a class="nav-link" href="/admin/salesreport">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              Report
            </a>
            <a class="nav-link" href="/admin/order-management">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              Order Management
            </a>
            <a class="nav-link" href="/admin/category-management">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              Category Management
            </a>
            <a class="nav-link" href="/admin/user-management">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              User Management
            </a>
            <a class="nav-link" href="/admin/product-mgmt">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              Produc Management
            </a>
            <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseLayouts"
              aria-expanded="false" aria-controls="collapseLayouts">
              <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
              Offers/Coupons
              <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
            </a>
            <div class="collapse" id="collapseLayouts" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
              <nav class="sb-sidenav-menu-nested nav">
                <a class="nav-link" href="/admin/coupons">Product-offer</a>
                <a class="nav-link" href="/admin/category-offer">Category-offer</a>
                <a class="nav-link" href="/admin/coupon-offer">Coupons</a>

              </nav>
            </div>
              <a class="nav-link" href="/admin/banners">
              <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
              Banners
            </a>

          </div>
        </div>
        <div class="sb-sidenav-footer">
          <div class="small">Logged in as:</div>
          Start Bootstrap
        </div>
      </nav>
    </div>
    <div id="layoutSidenav_content">
      <main>

        <div class="div container">

          <h3 class="text-center p-3">Sales report</h3>

          <div class="row p-3">
            <input class="m-2" style="width: 200px;" required type="date" id="date1" name="exp_date">

            <input class="m-2" style="width: 200px;" required type="date" id="date2" name="exp_date">
            <button class="m-2 btn btn-success" onclick="search()" style="width: 100px;">Search</button>


          </div>


          <button class="btn btn-success ms-3" onclick="filterDay('daily')">day</button>
          <button class="btn btn-success " onclick="filterDay('monthly')">month</button>
          <button class="btn btn-success " onclick="filterDay('weekly')">weekly</button>
          <button class="btn btn-success " onclick="filterDay('yearly')">yearly</button>
          <div class="p-3 table-responsive">

            <table id="myTable" class="table table-bordered">
              <thead>
                <tr>
                  <th>SL.NO</th>
                  <th>Order Id</th>
                  <th>User Id</th>
                  <th>Products</th>
                  <th>Payment</th>
                  <th>Date</th>
                  <th>Amount</th>

                </tr>
              </thead>
              <tbody id="myList">
                {{#each result}}
                <tr>
                  <td>{{calculation @index}} </td>
                  <td>{{this._id}}</td>
                  <td>{{this.userId}}</td>
                  <td>{{this.item}}</td>
                  <td>{{this.payment}}</td>
                  <td>{{this.date}}</td>
                  <td>{{this.amount}}</td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        </div>





      </main>
      <footer class="py-4 bg-light mt-auto">

      </footer>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
  <script src="/javascripts/js/scripts.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
  <script src="/assets/demo/chart-area-demo.js"></script>
  <script src="/assets/demo/chart-bar-demo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
  <script src="/javascripts/js/datatables-simple-demo.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
</body>

</html>





<script>
  let table;
  $(document).ready(function () {

    table = $('#myTable').DataTable({
      "footerCallback": function (row, data, start, end, display) {
        var api = this.api(), data;

        // Remove the formatting to get integer data for summation
        var intVal = function (i) {
          return typeof i === 'string' ?
            i.replace(/[\$,]/g, '') * 1 :
            typeof i === 'number' ?
              i : 0;
        };

        // Total over all pages
        total = api
          .column(4)
          .data()
          .reduce(function (a, b) {
            return intVal(a) + intVal(b);
          }, 0);


        // Update footer
        $(api.column(4).footer()).html(
          ' ( $' + total + ' total)'
        );
      },
      dom: 'Bfrtip',
      buttons: [
        'excel', 'pdf', 'print'
      ],
    });

  })


  var today = new Date();
  var dd = String(today.getDate()).padStart(2, '0');
  var mm = String(today.getMonth() + 1).padStart(2, '0');
  var yyyy = today.getFullYear();

  today = yyyy + '-' + mm + '-' + dd;
  $('#date1').attr('max', today);
  $('#date2').attr('max', today);
  document.getElementById('date1').onchange=e=>{
    value=e.target.value
 
    $('#date2').attr('min', value);
  }

  function search() {
    let date1 = document.getElementById("date1").value
    let date2 = document.getElementById("date2").value
    alert("asdasd")
    $.ajax({
      url: '/admin/search-by-date',
      method: 'post',
      data: { date1, date2 },
      success: function (response) {
        console.log(response)
        table.destroy();

        document.getElementById("myList").innerHTML = "";

        for (let i = 0; i < response.response.length; i++) {
          newelement = `  <tr>
             <td>${i + 1} </td>
          <td>${response.response[i]._id}</td>
          <td>${response.response[i].orderObj.userid}</td>
          <td>${response.response[i].orderObj.products[0].item}</td>
          <td>${response.response[i].orderObj.payment}</td>
          <td>${response.response[i].orderObj.date}</td>
          <td>${response.response[i].orderObj.amount}</td>
        </tr> `
          document.getElementById("myList").innerHTML += newelement

        }
        table = $('#myTable').DataTable({
          "footerCallback": function (row, data, start, end, display) {
            var api = this.api(), data;

            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
              return typeof i === 'string' ?
                i.replace(/[\$,]/g, '') * 1 :
                typeof i === 'number' ?
                  i : 0;
            };

            // Total over all pages
            total = api
              .column(4)
              .data()
              .reduce(function (a, b) {
                return intVal(a) + intVal(b);
              }, 0);


            // Update footer
            $(api.column(4).footer()).html(
              ' ( $' + total + ' total)'
            );
          },
          dom: 'Bfrtip',
          buttons: [
            'excel', 'pdf', 'print'
          ],
        });
       


      }

    })


  }



  function filterDay(date) {
    alert(date)


    $.ajax({
      url: '/admin/filter',
      method: 'post',
      data: { day: date },
      success: function (response) {
        table.destroy();
        console.log(response.filtered_item)
        document.getElementById("myList").innerHTML = "";
        for (let i = 0; i < response.filtered_item.length; i++) {

          newelement = `  <tr>
          <td>${i + 1} </td>
          <td>${response.filtered_item[i]._id}</td>
          <td>${response.filtered_item[i].orderObj.userid}</td>
          <td>${response.filtered_item[i].orderObj.products[0].item}</td>
          <td>${response.filtered_item[i].orderObj.payment}</td>
          <td>${response.filtered_item[i].orderObj.date}</td>
          <td>${response.filtered_item[i].orderObj.amount}</td>
        </tr>  
        `
          document.getElementById("myList").innerHTML += newelement;

        }
        table = $('#myTable').DataTable({
          "footerCallback": function (row, data, start, end, display) {
            var api = this.api(), data;

            // Remove the formatting to get integer data for summation
            var intVal = function (i) {
              return typeof i === 'string' ?
                i.replace(/[\$,]/g, '') * 1 :
                typeof i === 'number' ?
                  i : 0;
            };

            // Total over all pages
            total = api
              .column(4)
              .data()
              .reduce(function (a, b) {
                return intVal(a) + intVal(b);
              }, 0);


            // Update footer
            $(api.column(4).footer()).html(
              ' ( $' + total + ' total)'
            );
          },
          dom: 'Bfrtip',
          buttons: [
            'excel', 'pdf', 'print'
          ],
        });


      }

    })

  }




  function myFunction() {
    // Declare variables
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");

    // Loop through all table rows, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("td")[5];
      if (td) {
        txtValue = td.textContent || td.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }









</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>